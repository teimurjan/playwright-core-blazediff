{
  "version": 3,
  "sources": ["../../../src/server/utils/zones.ts"],
  "sourcesContent": ["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AsyncLocalStorage } from 'async_hooks';\n\nexport type ZoneType = 'apiZone' | 'stepZone';\n\nconst asyncLocalStorage = new AsyncLocalStorage<Zone | undefined>();\n\nexport class Zone {\n  private readonly _asyncLocalStorage: AsyncLocalStorage<Zone | undefined>;\n  private readonly _data: ReadonlyMap<ZoneType, unknown>;\n\n  constructor(asyncLocalStorage: AsyncLocalStorage<Zone | undefined>, store: Map<ZoneType, unknown>) {\n    this._asyncLocalStorage = asyncLocalStorage;\n    this._data = store;\n  }\n\n  with(type: ZoneType, data: unknown): Zone {\n    return new Zone(this._asyncLocalStorage, new Map(this._data).set(type, data));\n  }\n\n  without(type?: ZoneType): Zone {\n    const data = type ? new Map(this._data) : new Map();\n    data.delete(type);\n    return new Zone(this._asyncLocalStorage, data);\n  }\n\n  run<R>(func: () => R): R {\n    return this._asyncLocalStorage.run(this, func);\n  }\n\n  data<T>(type: ZoneType): T | undefined {\n    return this._data.get(type) as T | undefined;\n  }\n}\n\nexport const emptyZone = new Zone(asyncLocalStorage, new Map());\n\nexport function currentZone(): Zone {\n  return asyncLocalStorage.getStore() ?? emptyZone;\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAgBA,yBAAkC;AAIlC,MAAM,oBAAoB,IAAI,qCAAoC;AAE3D,MAAM,KAAK;AAAA,EAIhB,YAAYA,oBAAwD,OAA+B;AACjG,SAAK,qBAAqBA;AAC1B,SAAK,QAAQ;AAAA,EACf;AAAA,EAEA,KAAK,MAAgB,MAAqB;AACxC,WAAO,IAAI,KAAK,KAAK,oBAAoB,IAAI,IAAI,KAAK,KAAK,EAAE,IAAI,MAAM,IAAI,CAAC;AAAA,EAC9E;AAAA,EAEA,QAAQ,MAAuB;AAC7B,UAAM,OAAO,OAAO,IAAI,IAAI,KAAK,KAAK,IAAI,oBAAI,IAAI;AAClD,SAAK,OAAO,IAAI;AAChB,WAAO,IAAI,KAAK,KAAK,oBAAoB,IAAI;AAAA,EAC/C;AAAA,EAEA,IAAO,MAAkB;AACvB,WAAO,KAAK,mBAAmB,IAAI,MAAM,IAAI;AAAA,EAC/C;AAAA,EAEA,KAAQ,MAA+B;AACrC,WAAO,KAAK,MAAM,IAAI,IAAI;AAAA,EAC5B;AACF;AAEO,MAAM,YAAY,IAAI,KAAK,mBAAmB,oBAAI,IAAI,CAAC;AAEvD,SAAS,cAAoB;AAClC,SAAO,kBAAkB,SAAS,KAAK;AACzC;",
  "names": ["asyncLocalStorage"]
}
